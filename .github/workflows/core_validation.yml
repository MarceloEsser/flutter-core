name: Testes com Cobertura
on:
  push:
    branches:
      - master
      - feature/*
      - hotfix/*
      - release/*

jobs:
  test:
    name: Testes com Cobertura
    runs-on: ubuntu-latest
    steps:
      - name: Checkout do código
        uses: actions/checkout@v2

      - name: Configurar Flutter
        uses: subosito/flutter-action@v2
        
      - name: Obter dependências
        run: flutter pub get

      - name: Executar testes com cobertura
        run: flutter test --coverage

      - name: Atualizar COVERAGE.md
        run: |
          lcov --list coverage/lcov.info --no-legend | \
          grep -v "flutter_test" | \
          grep -v "generated_plugin_registrant" | \
          grep -v "test/widget_test" > coverage/filtered_lcov.info
          bash <(curl -s https://codecov.io/bash) -f coverage/filtered_lcov.info -F flutter

          # Geração do arquivo COVERAGE.md
          echo "## Cobertura de Testes" > COVERAGE.md
          echo "" >> COVERAGE.md
          echo "Última Atualização: $(date)" >> COVERAGE.md
          echo "" >> COVERAGE.md
          echo "![coverage](https://codecov.io/gh/seu-usuario/seu-projeto/branch/main/graph/badge.svg)" >> COVERAGE.md
          echo "" >> COVERAGE.md
          echo "Detalhes completos disponíveis em [Codecov](https://codecov.io/gh/seu-usuario/seu-projeto)" >> COVERAGE.md
